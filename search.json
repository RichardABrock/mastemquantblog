[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "mastemquantblog",
    "section": "",
    "text": "Working Time graph\n\n\n\n\n\n\n\n\n\n\n\n\nOwen James-Gray\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To STEM MA Quantitative methods in Educational Research Blog\n\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n\n\nNov 2, 2023\n\n\nRichard Brock and Peter Kemp\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To STEM MA Quantitative methods in Educational Research Blog",
    "section": "",
    "text": "We will use this blog to display student work from the MA STEM Quantitative methods in Educational Research\n\n# Create a dataframe of country latitude and longitude data\nworld_data &lt;- map_data(map=\"world\")\n\n# Create a dataframe of mean PISA science scores, and rename CNT to region\n# for the leftjoin mergining of dataframes\nWorldSci&lt;-PISA_2018%&gt;%\n  select(CNT, PV1SCIE)%&gt;%\n  group_by(CNT)%&gt;%\n  summarise(meanSci=mean(PV1SCIE, na.rm=TRUE))%&gt;%\n  rename(region=CNT)\n\nlevels(WorldSci$region)[levels(WorldSci$region)==\"United Kingdom\"] &lt;- \"UK\"\nlevels(WorldSci$region)[levels(WorldSci$region)==\"United States\"] &lt;- \"USA\"\nlevels(WorldSci$region)[levels(WorldSci$region)==\"B-S-J-Z (China)\"] &lt;- \"China\"\nlevels(WorldSci$region)[levels(WorldSci$region)==\"Russian Federation\"] &lt;- \"Russia\"\n\n\nViet&lt;-PISA_2018%&gt;%\n  select(PV1SCIE, CNT)%&gt;%\n  filter(CNT==\"Vietnam\")\n  \n# Add the country latitude and longitude data to the PISA scores\nWorldSci&lt;-left_join(world_data, WorldSci, by=\"region\")\n# Use geom_map to plot the basic world map (fill is white, line colour is black)\n# Use geom_polygon to plot the PISA data\n# Add a colour scale\n\nLabels&lt;-WorldSci%&gt;%\n  group_by(region)%&gt;%\n  summarise(meanSci=mean(meanSci), lat=mean(lat), long=mean(long))%&gt;%\n  na.omit()\n\n\n\nggplot(data = WorldSci, aes(x=long, y=lat, group=group)) +\n  geom_map(data=world_data, map=world_data, aes(map_id=region), fill=\"white\", colour=\"black\")+\n  geom_polygon(aes(fill=meanSci)) +\n  scale_fill_viridis_c(option = \"viridis\")+\n  geom_text_repel(data=Labels, inherit.aes = F, aes(x=long, y=lat,label=region),\n                  size=3)+\n  ggtitle(\"Mean PISA scoures by country\")+\n  theme(plot.title = element_text(hjust = 0.5))"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "The blog for the KCL MA STEM Quantitative Methods in Educational Research Module. This blog will display student work produced in R."
  },
  {
    "objectID": "posts/test post/MASTEMquant.html",
    "href": "posts/test post/MASTEMquant.html",
    "title": "MASTEMQuant",
    "section": "",
    "text": "This is a page to show student work from the MA STEM Quantitative Methods in Educational Research Module"
  },
  {
    "objectID": "posts/test post/MASTEMquant.html#ma-stem-education-quantitative-methods-in-educational-research---student-projects",
    "href": "posts/test post/MASTEMquant.html#ma-stem-education-quantitative-methods-in-educational-research---student-projects",
    "title": "MASTEMQuant",
    "section": "",
    "text": "This is a page to show student work from the MA STEM Quantitative Methods in Educational Research Module"
  },
  {
    "objectID": "posts/test post/MASTEMquant.html#example-code",
    "href": "posts/test post/MASTEMquant.html#example-code",
    "title": "MASTEMQuant",
    "section": "Example code",
    "text": "Example code\n\n# Create a UK subset\nPISAUK&lt;-PISA_2018%&gt;%\n  filter(CNT==\"United Kingdom\")%&gt;%\n  select(PV1SCIE, PV1MATH)\n# Plot scores, but add them to bins to reduce over ploting\n# Set a colour scale to show number in bins\nggplot(PISAUK, aes(x=PV1MATH, y=PV1SCIE))+\n  stat_bin2d(bins = 90) +\n  scale_fill_gradient(low = \"lightblue\", high = \"red\", limits = c(0, 80))+\n  ggtitle(\"UK PISA Science and Mathematics scores\")+\n  labs(x=\"Mathematics score\", y=\"Science Score\")"
  },
  {
    "objectID": "posts/P8Analysis/P8Analysis.html",
    "href": "posts/P8Analysis/P8Analysis.html",
    "title": "P8Data20222023",
    "section": "",
    "text": "library(BayesFactor)\n\nLoading required package: coda\n\n\nLoading required package: Matrix\n\n\n\nAttaching package: 'Matrix'\n\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\n\n************\nWelcome to BayesFactor 0.9.12-4.5. If you have questions, please contact Richard Morey (richarddmorey@gmail.com).\n\nType BFManual() to open the manual.\n************\n\nsubset&lt;-dfe2023%&gt;%\n  select(P8MEA,PTFSM6CLA1A, PTEALGRP2, PSENE4)\nsubset$P8MEA&lt;-as.numeric(subset$P8MEA)\n\nsubset$PTFSM6CLA1A&lt;-parse_number(subset$PTFSM6CLA1A)\n\nWarning: 1818 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PTEALGRP2&lt;-parse_number(subset$PTEALGRP2)\n\nWarning: 1833 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PSENE4&lt;-parse_number(subset$PSENE4)\n\nWarning: 1 parsing failure.\n row col expected actual\n7355  -- a number   SUPP\n\nsubset&lt;-subset%&gt;%\n  na.omit()\nmodels&lt;-regressionBF(P8MEA ~ ., data = subset)\n\nWarning: data coerced from tibble to data frame\n\noutput&lt;-as.data.frame(models@bayesFactor)\n\nggplot(output, aes(x=reorder(rownames(output), - bf), y=bf, fill=rownames(output)))+\n  geom_col() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))"
  },
  {
    "objectID": "posts/P8Analysis/P8Analysis.html#p8-analysis",
    "href": "posts/P8Analysis/P8Analysis.html#p8-analysis",
    "title": "P8Data20222023",
    "section": "",
    "text": "library(BayesFactor)\n\nLoading required package: coda\n\n\nLoading required package: Matrix\n\n\n\nAttaching package: 'Matrix'\n\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\n\n************\nWelcome to BayesFactor 0.9.12-4.5. If you have questions, please contact Richard Morey (richarddmorey@gmail.com).\n\nType BFManual() to open the manual.\n************\n\nsubset&lt;-dfe2023%&gt;%\n  select(P8MEA,PTFSM6CLA1A, PTEALGRP2, PSENE4)\nsubset$P8MEA&lt;-as.numeric(subset$P8MEA)\n\nsubset$PTFSM6CLA1A&lt;-parse_number(subset$PTFSM6CLA1A)\n\nWarning: 1818 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PTEALGRP2&lt;-parse_number(subset$PTEALGRP2)\n\nWarning: 1833 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PSENE4&lt;-parse_number(subset$PSENE4)\n\nWarning: 1 parsing failure.\n row col expected actual\n7355  -- a number   SUPP\n\nsubset&lt;-subset%&gt;%\n  na.omit()\nmodels&lt;-regressionBF(P8MEA ~ ., data = subset)\n\nWarning: data coerced from tibble to data frame\n\noutput&lt;-as.data.frame(models@bayesFactor)\n\nggplot(output, aes(x=reorder(rownames(output), - bf), y=bf, fill=rownames(output)))+\n  geom_col() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))"
  },
  {
    "objectID": "posts/P8Analysis/P8Analysis.html#grouped-scatter-plot-with-marginal-density-plots",
    "href": "posts/P8Analysis/P8Analysis.html#grouped-scatter-plot-with-marginal-density-plots",
    "title": "P8Data20222023",
    "section": "Grouped Scatter plot with marginal density plots",
    "text": "Grouped Scatter plot with marginal density plots\n\nlibrary(ggpubr)\n\n# Grouped Scatter plot with marginal density plots\n\nplotdata&lt;-dfe2023%&gt;%\n  filter(ICLOSE==0)%&gt;%\n  filter(P8MEA!=\"NP\")%&gt;%\n  filter(P8MEA!=\"NE\")%&gt;%\n  filter(P8MEA!=\"SUPP\")%&gt;%\n  select(P8MEA, PTFSM6CLA1A, ADMPOL,SCHNAME)%&gt;%\n  na.omit()%&gt;%\n  mutate(label=ifelse(P8MEA&gt;1.3,SCHNAME,\"\"))%&gt;%\n  mutate(ADMPOL=ifelse(ADMPOL==\"NR\",\"Not recorded\",\n                       ifelse(ADMPOL==\"SEL\",\"Selective\", \n                              ifelse(ADMPOL==\"NSE\",\"Not selective\", NA))))\nplotdata$P8MEA&lt;-as.numeric(plotdata$P8MEA)\n\nplotdata$PTFSM6CLA1A&lt;-parse_number(plotdata$PTFSM6CLA1A)\n\nggscatterhist(data=plotdata, y=\"P8MEA\", x=\"PTFSM6CLA1A\",\n              color =\"ADMPOL\", size = 0.5, alpha = 0.4,\n              margin.params = list(fill = \"ADMPOL\", color = \"black\", size = 0.2),\n              ggtheme = theme_bw())"
  },
  {
    "objectID": "posts/P8Analysis/P8Analysis.html#section",
    "href": "posts/P8Analysis/P8Analysis.html#section",
    "title": "P8Data20222023",
    "section": "",
    "text": "P8 Best model\n\nlibrary(BayesFactor)\n\nsubset&lt;-dfe2023%&gt;%\n  select(P8MEA,PTFSM6CLA1A, PTEALGRP2, PSENE4)\nsubset$P8MEA&lt;-as.numeric(subset$P8MEA)\n\nsubset$PTFSM6CLA1A&lt;-parse_number(subset$PTFSM6CLA1A)\n\nWarning: 1818 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PTEALGRP2&lt;-parse_number(subset$PTEALGRP2)\n\nWarning: 1833 parsing failures.\nrow col expected actual\n  1  -- a number     NP\n  2  -- a number     NP\n  3  -- a number     NP\n  7  -- a number     NP\n  8  -- a number     NP\n... ... ........ ......\nSee problems(...) for more details.\n\nsubset$PSENE4&lt;-parse_number(subset$PSENE4)\n\nWarning: 1 parsing failure.\n row col expected actual\n7355  -- a number   SUPP\n\nsubset&lt;-subset%&gt;%\n  na.omit()\nmodels&lt;-regressionBF(P8MEA ~ ., data = subset)\n\nWarning: data coerced from tibble to data frame\n\noutput&lt;-as.data.frame(models@bayesFactor)\n\nggplot(output, aes(x=reorder(rownames(output), - bf), y=bf, fill=rownames(output)))+\n  geom_col() +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))"
  },
  {
    "objectID": "posts/Post 1/Post1.html",
    "href": "posts/Post 1/Post1.html",
    "title": "PISA 2022 science and mathematics scores",
    "section": "",
    "text": "Correlation between mathematics and science scores in PISA 2022 data"
  },
  {
    "objectID": "posts/Post 1/Post1.html#patterns-of-science-and-mathematics-achievement",
    "href": "posts/Post 1/Post1.html#patterns-of-science-and-mathematics-achievement",
    "title": "PISA 2022 science and mathematics scores",
    "section": "",
    "text": "Correlation between mathematics and science scores in PISA 2022 data"
  },
  {
    "objectID": "posts/Working Graph/Working Graph.html",
    "href": "posts/Working Graph/Working Graph.html",
    "title": "Working Time graph",
    "section": "",
    "text": "Looking through the questions asked on the PISA 2022 dataset I saw that the number of times a student had worked a job during the week was included. I was interested to see if this had an effect on their scores in the tested domains of reading, maths and science. I had a couple of hypothesis to check that work in opposite directions.\n\n\n\nWorking in free time during non-school hours displays a strong work ethic and hence that same work ethic could be applied to school work too.\n\n\n\nWorking in their free time has an opportunity cost, every hour spent working is an hour that could have been spent studying, resulting in a negative impact on PISA score.\n\n\n\nUsing R I took the PISA 2022 dataset, averaged the three scores (reading, maths and science) of each pupil to get a total score for each pupil (SCORE_AVG).\nI realised that certain countries with different levels of economic development and different cultures surrounding children working may also have different PISA scores so I came up with a modified pupil score relative to the scores of their own country, this score represents the number of standard deviations a student is away from the average score of their own country (STU_REL_SCORE) so for example a value of -0.55 would mean that student had an average score in the three domains that was 0.55 standard deviations below the country average score. This was then compared against the number of times a student had worked during the week.\nHere is the code:\n\nlibrary(arrow)\nlibrary(tidyverse)\n\n# PISA_2022 &lt;- read_parquet(r\"[C:\\Users\\owenp\\OneDrive\\Documents\\R\\PISA_student_2022_subset.parquet]\")\n\nPISA_2022 &lt;- read_parquet(\"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/2022/PISA_student_2022_subset.parquet\")\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(CNT, PV1MATH, PV1READ, PV1SCIE, WORKPAY) %&gt;% \n  mutate(SCORE_AVG = ((PV1MATH + PV1READ + PV1SCIE)/3)) %&gt;% \n  group_by(CNT) %&gt;% \n  mutate(CNT_AVG_SCORE = mean(SCORE_AVG)) %&gt;%\n  mutate(CNT_SD_SCORE = sd(SCORE_AVG)) %&gt;% \n  ungroup() %&gt;% \n  mutate(STU_REL_SCORE = ((SCORE_AVG-CNT_AVG_SCORE)/CNT_SD_SCORE)) %&gt;% \n  select(CNT, SCORE_AVG, CNT_AVG_SCORE, CNT_SD_SCORE, STU_REL_SCORE, WORKPAY) %&gt;%\n  filter(!is.na(WORKPAY))\n\nWhen plotted this results in the following graph:\n\n# Define a custom function to map original levels to shorter labels\nmap_workpay_labels &lt;- function(original_label) {\n  # Define mapping for each level\n  level_mapping &lt;- c(\n    \"No work for pay\" = \"zero\",\n    \"1 time of working for pay per week\" = \"one\",\n    \"2 times of working for pay per week\" = \"two\",\n    \"3 times of working for pay per week\" = \"three\",\n    \"4 times of working for pay per week\" = \"four\",\n    \"5 times of working for pay per week\" = \"five\",\n    \"6 times of working for pay per week\" = \"six\",\n    \"7 times of working for pay per week\" = \"seven\",\n    \"8 times of working for pay per week\" = \"eight\",\n    \"9 times of working for pay per week\" = \"nine\",\n    \"10 or more times of working for pay per week\" = \"more than ten\"\n  )\n  \n  # Use the level_mapping to map the original_label to the shorter label\n  return(level_mapping[original_label])\n}\n\n# Apply the custom function to the \"WORKPAY\" column\navg_score$WORKPAY &lt;- sapply(avg_score$WORKPAY, map_workpay_labels)\n\n# Convert \"WORKPAY\" to a factor with desired order of levels\navg_score$WORKPAY &lt;- factor(avg_score$WORKPAY, levels = c(\"zero\", \"one\", \"two\", \"three\", \"four\", \"five\", \"six\", \"seven\", \"eight\", \"nine\", \"more than ten\"))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=STU_REL_SCORE)) +\n  geom_violin(fill=\"lightblue\")+\n  ggtitle(\"How working affects student scores across the world\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student average score normalised relative to own country\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n\n\n\nIn which there does seem to be a negative correlation between number of times a student works and their relative score.\nThis is made clearer if we remove the violin distribution plots and just look at the averages. The times worked per week as contained within the PISA dataset is a categoric variable so in order to do a linear plot it needs to be made into a numeric variable first so the little bit of code below does that before then plotting a line graph.\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(CNT, PV1MATH, PV1READ, PV1SCIE, WORKPAY) %&gt;% \n  mutate(SCORE_AVG = ((PV1MATH + PV1READ + PV1SCIE)/3)) %&gt;% \n  group_by(CNT) %&gt;% \n  mutate(CNT_AVG_SCORE = mean(SCORE_AVG)) %&gt;%\n  mutate(CNT_SD_SCORE = sd(SCORE_AVG)) %&gt;% \n  ungroup() %&gt;% \n  mutate(STU_REL_SCORE = ((SCORE_AVG-CNT_AVG_SCORE)/CNT_SD_SCORE)) %&gt;% \n  select(CNT, SCORE_AVG, CNT_AVG_SCORE, CNT_SD_SCORE, STU_REL_SCORE, WORKPAY) %&gt;%\n  mutate(WORKPAY = \n           case_when(WORKPAY == \"No work for pay\" ~ 0,\n                     WORKPAY == \"1 time of working for pay per week\" ~ 1,\n                     WORKPAY == \"2 times of working for pay per week\" ~ 2,\n                     WORKPAY == \"3 times of working for pay per week\" ~ 3,\n                     WORKPAY == \"4 times of working for pay per week\" ~ 4,\n                     WORKPAY == \"5 times of working for pay per week\" ~ 5,\n                     WORKPAY == \"6 times of working for pay per week\" ~ 6,\n                     WORKPAY == \"7 times of working for pay per week\" ~ 7,\n                     WORKPAY == \"8 times of working for pay per week\" ~ 8,\n                     WORKPAY == \"9 times of working for pay per week\" ~ 9,\n                     WORKPAY == \"10 or more times of working for pay per week\" ~ NA,\n                     .default = NA)) %&gt;%\n  filter(!is.na(WORKPAY))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=STU_REL_SCORE)) +\n  geom_smooth(method = 'lm')+\n  ggtitle(\"How working affects student scores across the world\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student average score normalised relative to own country\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\nWhich does show more clearly a negative correlation between times worked per week when times is less than 5. The correlation gets a little more noisy after that. I speculate this is because working more than 5 times per week would mean working more than every weekday, which might mean students answering the questionnaire with larger numbers may be defining a “working” period differently than those answering with smaller values or perhaps have misread the question making the data noisier for values over 5.\nOne thing in discussion with Peter and Richard I realised was that this model while it takes account of differences in economic status by country, it does not take into account differences in socioeconomic status between students. It is completely plausible that even within a country poorer students might be having to work more than richer ones, and it fairly established that students with lower socioeconomic status get lower scores on PISA tests (OECD, 2018). This might mean that all we are seeing in this graph is that effect, rather than any effect from working in a job. To remedy this we can adapt our model to control for socioeconomic status.\n\n\n\nFirst of all let’s see if there is a relationship between a student working in a job and their ESCS.\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(WORKPAY, ESCS) %&gt;% \n  mutate(WORKPAY = \n           case_when(WORKPAY == \"No work for pay\" ~ 0,\n                     WORKPAY == \"1 time of working for pay per week\" ~ 1,\n                     WORKPAY == \"2 times of working for pay per week\" ~ 2,\n                     WORKPAY == \"3 times of working for pay per week\" ~ 3,\n                     WORKPAY == \"4 times of working for pay per week\" ~ 4,\n                     WORKPAY == \"5 times of working for pay per week\" ~ 5,\n                     WORKPAY == \"6 times of working for pay per week\" ~ 6,\n                     WORKPAY == \"7 times of working for pay per week\" ~ 7,\n                     WORKPAY == \"8 times of working for pay per week\" ~ 8,\n                     WORKPAY == \"9 times of working for pay per week\" ~ 9,\n                     WORKPAY == \"10 or more times of working for pay per week\" ~ NA,\n                     .default = NA)) %&gt;%\n  filter(!is.na(WORKPAY))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=ESCS)) +\n  geom_smooth(method = 'lm')+\n  ggtitle(\"Do low socioeconomic status students work more times a week?\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student socioeconomic status\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 8320 rows containing non-finite values (`stat_smooth()`).\n\n\nWarning: Removed 8320 rows containing non-finite values (`stat_summary()`).\n\n\n\n\n\n\n\n\nOECD. (2018). Equity in Education: Breaking Down Barriers to Social Mobility. OECD. https://doi.org/10.1787/9789264073234-en"
  },
  {
    "objectID": "posts/Working Graph/Working Graph.html#does-working-a-job-impact-student-performance",
    "href": "posts/Working Graph/Working Graph.html#does-working-a-job-impact-student-performance",
    "title": "Working Time graph",
    "section": "",
    "text": "Looking through the questions asked on the PISA 2022 dataset I saw that the number of times a student had worked a job during the week was included. I was interested to see if this had an effect on their scores in the tested domains of reading, maths and science. I had a couple of hypothesis to check that work in opposite directions.\n\n\n\nWorking in free time during non-school hours displays a strong work ethic and hence that same work ethic could be applied to school work too.\n\n\n\nWorking in their free time has an opportunity cost, every hour spent working is an hour that could have been spent studying, resulting in a negative impact on PISA score.\n\n\n\nUsing R I took the PISA 2022 dataset, averaged the three scores (reading, maths and science) of each pupil to get a total score for each pupil (SCORE_AVG).\nI realised that certain countries with different levels of economic development and different cultures surrounding children working may also have different PISA scores so I came up with a modified pupil score relative to the scores of their own country, this score represents the number of standard deviations a student is away from the average score of their own country (STU_REL_SCORE) so for example a value of -0.55 would mean that student had an average score in the three domains that was 0.55 standard deviations below the country average score. This was then compared against the number of times a student had worked during the week.\nHere is the code:\n\nlibrary(arrow)\nlibrary(tidyverse)\n\n# PISA_2022 &lt;- read_parquet(r\"[C:\\Users\\owenp\\OneDrive\\Documents\\R\\PISA_student_2022_subset.parquet]\")\n\nPISA_2022 &lt;- read_parquet(\"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/2022/PISA_student_2022_subset.parquet\")\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(CNT, PV1MATH, PV1READ, PV1SCIE, WORKPAY) %&gt;% \n  mutate(SCORE_AVG = ((PV1MATH + PV1READ + PV1SCIE)/3)) %&gt;% \n  group_by(CNT) %&gt;% \n  mutate(CNT_AVG_SCORE = mean(SCORE_AVG)) %&gt;%\n  mutate(CNT_SD_SCORE = sd(SCORE_AVG)) %&gt;% \n  ungroup() %&gt;% \n  mutate(STU_REL_SCORE = ((SCORE_AVG-CNT_AVG_SCORE)/CNT_SD_SCORE)) %&gt;% \n  select(CNT, SCORE_AVG, CNT_AVG_SCORE, CNT_SD_SCORE, STU_REL_SCORE, WORKPAY) %&gt;%\n  filter(!is.na(WORKPAY))\n\nWhen plotted this results in the following graph:\n\n# Define a custom function to map original levels to shorter labels\nmap_workpay_labels &lt;- function(original_label) {\n  # Define mapping for each level\n  level_mapping &lt;- c(\n    \"No work for pay\" = \"zero\",\n    \"1 time of working for pay per week\" = \"one\",\n    \"2 times of working for pay per week\" = \"two\",\n    \"3 times of working for pay per week\" = \"three\",\n    \"4 times of working for pay per week\" = \"four\",\n    \"5 times of working for pay per week\" = \"five\",\n    \"6 times of working for pay per week\" = \"six\",\n    \"7 times of working for pay per week\" = \"seven\",\n    \"8 times of working for pay per week\" = \"eight\",\n    \"9 times of working for pay per week\" = \"nine\",\n    \"10 or more times of working for pay per week\" = \"more than ten\"\n  )\n  \n  # Use the level_mapping to map the original_label to the shorter label\n  return(level_mapping[original_label])\n}\n\n# Apply the custom function to the \"WORKPAY\" column\navg_score$WORKPAY &lt;- sapply(avg_score$WORKPAY, map_workpay_labels)\n\n# Convert \"WORKPAY\" to a factor with desired order of levels\navg_score$WORKPAY &lt;- factor(avg_score$WORKPAY, levels = c(\"zero\", \"one\", \"two\", \"three\", \"four\", \"five\", \"six\", \"seven\", \"eight\", \"nine\", \"more than ten\"))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=STU_REL_SCORE)) +\n  geom_violin(fill=\"lightblue\")+\n  ggtitle(\"How working affects student scores across the world\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student average score normalised relative to own country\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n\n\n\nIn which there does seem to be a negative correlation between number of times a student works and their relative score.\nThis is made clearer if we remove the violin distribution plots and just look at the averages. The times worked per week as contained within the PISA dataset is a categoric variable so in order to do a linear plot it needs to be made into a numeric variable first so the little bit of code below does that before then plotting a line graph.\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(CNT, PV1MATH, PV1READ, PV1SCIE, WORKPAY) %&gt;% \n  mutate(SCORE_AVG = ((PV1MATH + PV1READ + PV1SCIE)/3)) %&gt;% \n  group_by(CNT) %&gt;% \n  mutate(CNT_AVG_SCORE = mean(SCORE_AVG)) %&gt;%\n  mutate(CNT_SD_SCORE = sd(SCORE_AVG)) %&gt;% \n  ungroup() %&gt;% \n  mutate(STU_REL_SCORE = ((SCORE_AVG-CNT_AVG_SCORE)/CNT_SD_SCORE)) %&gt;% \n  select(CNT, SCORE_AVG, CNT_AVG_SCORE, CNT_SD_SCORE, STU_REL_SCORE, WORKPAY) %&gt;%\n  mutate(WORKPAY = \n           case_when(WORKPAY == \"No work for pay\" ~ 0,\n                     WORKPAY == \"1 time of working for pay per week\" ~ 1,\n                     WORKPAY == \"2 times of working for pay per week\" ~ 2,\n                     WORKPAY == \"3 times of working for pay per week\" ~ 3,\n                     WORKPAY == \"4 times of working for pay per week\" ~ 4,\n                     WORKPAY == \"5 times of working for pay per week\" ~ 5,\n                     WORKPAY == \"6 times of working for pay per week\" ~ 6,\n                     WORKPAY == \"7 times of working for pay per week\" ~ 7,\n                     WORKPAY == \"8 times of working for pay per week\" ~ 8,\n                     WORKPAY == \"9 times of working for pay per week\" ~ 9,\n                     WORKPAY == \"10 or more times of working for pay per week\" ~ NA,\n                     .default = NA)) %&gt;%\n  filter(!is.na(WORKPAY))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=STU_REL_SCORE)) +\n  geom_smooth(method = 'lm')+\n  ggtitle(\"How working affects student scores across the world\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student average score normalised relative to own country\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\nWhich does show more clearly a negative correlation between times worked per week when times is less than 5. The correlation gets a little more noisy after that. I speculate this is because working more than 5 times per week would mean working more than every weekday, which might mean students answering the questionnaire with larger numbers may be defining a “working” period differently than those answering with smaller values or perhaps have misread the question making the data noisier for values over 5.\nOne thing in discussion with Peter and Richard I realised was that this model while it takes account of differences in economic status by country, it does not take into account differences in socioeconomic status between students. It is completely plausible that even within a country poorer students might be having to work more than richer ones, and it fairly established that students with lower socioeconomic status get lower scores on PISA tests (OECD, 2018). This might mean that all we are seeing in this graph is that effect, rather than any effect from working in a job. To remedy this we can adapt our model to control for socioeconomic status.\n\n\n\nFirst of all let’s see if there is a relationship between a student working in a job and their ESCS.\n\navg_score &lt;- PISA_2022 %&gt;% \n  select(WORKPAY, ESCS) %&gt;% \n  mutate(WORKPAY = \n           case_when(WORKPAY == \"No work for pay\" ~ 0,\n                     WORKPAY == \"1 time of working for pay per week\" ~ 1,\n                     WORKPAY == \"2 times of working for pay per week\" ~ 2,\n                     WORKPAY == \"3 times of working for pay per week\" ~ 3,\n                     WORKPAY == \"4 times of working for pay per week\" ~ 4,\n                     WORKPAY == \"5 times of working for pay per week\" ~ 5,\n                     WORKPAY == \"6 times of working for pay per week\" ~ 6,\n                     WORKPAY == \"7 times of working for pay per week\" ~ 7,\n                     WORKPAY == \"8 times of working for pay per week\" ~ 8,\n                     WORKPAY == \"9 times of working for pay per week\" ~ 9,\n                     WORKPAY == \"10 or more times of working for pay per week\" ~ NA,\n                     .default = NA)) %&gt;%\n  filter(!is.na(WORKPAY))\n\nggplot(data = avg_score,\n       aes(x=WORKPAY, y=ESCS)) +\n  geom_smooth(method = 'lm')+\n  ggtitle(\"Do low socioeconomic status students work more times a week?\")+\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +\n  xlab(\"Number of times worked per week\") +\n  ylab(\"Student socioeconomic status\") +\n  stat_summary(fun = \"mean\", geom = \"point\", color = \"black\",\n               position = position_dodge(width=0.9))\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 8320 rows containing non-finite values (`stat_smooth()`).\n\n\nWarning: Removed 8320 rows containing non-finite values (`stat_summary()`).\n\n\n\n\n\n\n\n\nOECD. (2018). Equity in Education: Breaking Down Barriers to Social Mobility. OECD. https://doi.org/10.1787/9789264073234-en"
  }
]